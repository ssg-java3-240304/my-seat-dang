<!DOCTYPE html>
<html lang="en" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{customer/layout/default}">
<head>
    <meta charset="UTF-8">
    <title>예약</title>

    <!-- Icon fonts -->
    <link th:href="@{/vendor/admin/font-awesome/css/font-awesome.min.css}" rel="stylesheet" type="text/css">
    <!-- Your custom styles -->
    <link th:href="@{/css/customer/detail-page.css}" rel="stylesheet">
    <link th:href="@{/css/admin/custom.css}" rel="stylesheet">
    <link th:href="@{/css/customer/customcss/reservation-list.css}" rel="stylesheet">
    <link th:href="@{/css/customer/customcss/chatstyle.css}" rel="stylesheet" type="text/css" >

    <style>
        #progress-bar {
            background-color: #4CAF50;
            height: 100%;
            transition: width 0.1s ease; /* 애니메이션이 더 부드럽게 진행되도록 설정 */
        }
        #toast {
            visibility: hidden;
            min-width: 250px;
            margin-left: -125px; /* 화면 가운데 정렬을 위한 margin-left 수정 */
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 5px;
            padding: 16px;
            position: fixed;
            z-index: 1000; /* z-index 값을 높여 다른 요소 위에 표시되도록 설정 */
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%); /* 화면 가운데 정렬 */
            font-size: 14px;
        }

        #toast.show {
            visibility: visible !important;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }

        @keyframes fadein {
            from {bottom: 0; opacity: 0;}
            to {bottom: 30px; opacity: 1;}
        }

        @keyframes fadeout {
            from {bottom: 30px; opacity: 1;}
            to {bottom: 0; opacity: 0;}
        }
    </style>
    <style>
        /* 사용자 정의 모달 스타일 */
        .custom-modal .modal-header {
            background-color: #4CAF50;
            color: white;
        }

        .custom-modal .modal-body {
            padding: 20px;
            font-size: 16px;
        }

        .custom-modal .modal-footer {
            display: flex;
            justify-content: space-between;
        }

        .custom-modal input[type="text"] {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            font-size: 14px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
    </style>

</head>
<body>
<main layout:fragment="main" class="bg_gray pattern">
    <div class="container margin_detail">
        <div class="row">
            <div class="col-lg-6">

                <div class="tabs_detail">
                    <ul class="nav nav-tabs" role="tablist">
                        <li class="nav-item">
                            <a id="tab-A" href="#pane-A" class="nav-link active" data-bs-toggle="tab" role="tab">전체예약</a>
                        </li>
                        <li class="nav-item">
                            <a id="tab-B" href="#pane-B" class="nav-link" data-bs-toggle="tab" role="tab">결제 전</a>
                        </li>
                        <li class="nav-item">
                            <a id="tab-C" href="#pane-C" class="nav-link" data-bs-toggle="tab" role="tab">방문예정</a>
                        </li>
                        <li class="nav-item">
                            <a id="tab-D" href="#pane-D" class="nav-link" data-bs-toggle="tab" role="tab">방문완료</a>
                        </li>
                        <li class="nav-item">
                            <a id="tab-E" href="#pane-E" class="nav-link" data-bs-toggle="tab" role="tab">취소됨</a>
                        </li>
                    </ul>

                    <div class="tab-content" role="tablist">
                        <div id="pane-A" class="card tab-pane fade show active" role="tabpanel" aria-labelledby="tab-A">
                            <div class="card-header" role="tab" id="heading-A">
                                <h5>
                                    <a class="collapsed" data-bs-toggle="collapse" href="#collapse-A" aria-expanded="true" aria-controls="collapse-A">
                                        전체예약
                                    </a>
                                </h5>
                            </div>
                            <div id="collapse-A" class="collapse" role="tabpanel" aria-labelledby="heading-A">
                                <div class="box_general">
                                    <div class="header_box">
                                        <h4 class="d-inline-block">예약 목록</h4>
                                    </div>
                                    <div class="list_general" th:each="reservation : ${reservations}" th:object="${reservation}">
                                        <ul>
                                            <li>
                                                <figure><img th:src="*{thumbnail}" alt=""></figure>
                                                <h4>[[*{storeName}]] <i th:class="*{reservationStatus.toString().toLowerCase()}">[[*{reservationStatus.getDescription()}]]</i></h4>
                                                <ul class="booking_list">
                                                    <li><strong>예약일</strong>[[*{reservedAt.toLocalDate()}]]</li>
                                                    <li><strong>예약시간</strong>[[*{reservedAt.toLocalTime()}]]</li>
                                                </ul>
                                                <p><a href="#" class="chat-button btn_1 gray"
                                                      th:data-reservation-id="*{reservationId}"
                                                      th:data-store-name="*{storeName}"
                                                      th:data-customer-name="*{customerName}"
                                                      th:data-customer-id="*{customerId}"
                                                      th:data-store-id="*{storeId}"
                                                      th:data-store-thumbnail="*{thumbnail}"
                                                      th:data-store-phone="*{storePhoneNumber}"
                                                      th:data-chat-url="${chatAccessUrl}">
                                                    <i class="fa fa-fw fa-envelope"></i> 디자인 상담</a>
                                                </p>
                                                <ul class="buttons" th:if="!(${reservation.reservationStatus.toString().equals('CANCELED')} or ${reservation.reservationStatus.toString().equals('VISIT_COMPLETED')})">
                                                    <li><a href="#cancel-modal" class="btn_1 gray delete cancelBtn" data-bs-toggle="modal" th:data-cancel-reservation-id="*{reservationId}"><i class="fa fa-fw fa-times-circle-o"></i> 예약취소</a></li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- /tab -->

                        <div id="pane-B" class="card tab-pane fade" role="tabpanel" aria-labelledby="tab-B">
                            <div class="card-header" role="tab" id="heading-B">
                                <h5>
                                    <a class="collapsed" data-bs-toggle="collapse" href="#collapse-B" aria-expanded="true" aria-controls="collapse-B">
                                        예약준비
                                    </a>
                                </h5>
                            </div>
                            <div id="collapse-B" class="collapse" role="tabpanel" aria-labelledby="heading-B">
                                <div class="box_general">
                                    <div class="header_box">
                                        <h4 class="d-inline-block">예약 목록</h4>
                                    </div>
                                    <div class="list_general" th:each="reservation : ${reservations}" th:object="${reservation}"  th:if="${reservation.reservationStatus.toString().equals('PENDING')} or ${reservation.reservationStatus.toString().equals('AWAITING_PAYMENT')} or ${reservation.reservationStatus.toString().equals('AWAITING_CUSTOM_PAYMENT')}">
                                        <ul>
                                            <li>
                                                <figure><img th:src="*{thumbnail}" alt=""></figure>
                                                <h4>[[*{storeName}]] <i th:class="*{reservationStatus.toString().toLowerCase()}">[[*{reservationStatus.getDescription()}]]</i></h4>
                                                <ul class="booking_list">
                                                    <li><strong>예약일</strong>[[*{reservedAt.toLocalDate()}]]</li>
                                                    <li><strong>예약시간</strong>[[*{reservedAt.toLocalTime()}]]</li>
                                                </ul>
                                                <p><a href="#" class="chat-button btn_1 gray"
                                                      th:data-reservation-id="*{reservationId}"
                                                      th:data-store-name="*{storeName}"
                                                      th:data-customer-name="*{customerName}"
                                                      th:data-customer-id="*{customerId}"
                                                      th:data-store-id="*{storeId}"
                                                      th:data-store-thumbnail="*{thumbnail}"
                                                      th:data-store-phone="*{storePhoneNumber}"
                                                      th:data-chat-url="${chatAccessUrl}">
                                                    <i class="fa fa-fw fa-envelope"></i> 디자인 상담</a>
                                                </p>
                                                <ul class="buttons">
                                                    <li><a href="#cancel-modal" class="btn_1 gray delete cancelBtn" data-bs-toggle="modal" th:data-cancel-reservation-id="*{reservationId}"><i class="fa fa-fw fa-times-circle-o"></i> 예약취소</a></li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- /tab -->
                        <!-- /tab2> -->

                        <div id="pane-C" class="card tab-pane fade" role="tabpanel" aria-labelledby="tab-C">
                            <div class="card-header" role="tab" id="heading-C">
                                <h5>
                                    <a class="collapsed" data-bs-toggle="collapse" href="#collapse-C" aria-expanded="true" aria-controls="collapse-C">
                                        방문예정
                                    </a>
                                </h5>
                            </div>
                            <div id="collapse-C" class="collapse" role="tabpanel" aria-labelledby="heading-C">
                                <div class="box_general">
                                    <div class="header_box">
                                        <h4 class="d-inline-block">예약 목록</h4>
                                    </div>
                                    <div class="list_general" th:each="reservation : ${reservations}" th:object="${reservation}" th:if="${reservation.reservationStatus.toString().equals('BEFORE_VISIT')}">
                                        <ul>
                                            <li>
                                                <figure><img th:src="*{thumbnail}" alt=""></figure>
                                                <h4>[[*{storeName}]] <i th:class="*{reservationStatus.toString().toLowerCase()}">[[*{reservationStatus.getDescription()}]]</i></h4>
                                                <ul class="booking_list">
                                                    <li><strong>예약일</strong>[[*{reservedAt.toLocalDate()}]]</li>
                                                    <li><strong>예약시간</strong>[[*{reservedAt.toLocalTime()}]]</li>
                                                </ul>
                                                <p><a href="#" class="chat-button btn_1 gray"
                                                      th:data-reservation-id="*{reservationId}"
                                                      th:data-store-name="*{storeName}"
                                                      th:data-customer-name="*{customerName}"
                                                      th:data-customer-id="*{customerId}"
                                                      th:data-store-id="*{storeId}"
                                                      th:data-store-thumbnail="*{thumbnail}"
                                                      th:data-store-phone="*{storePhoneNumber}"
                                                      th:data-chat-url="${chatAccessUrl}">
                                                    <i class="fa fa-fw fa-envelope"></i> 디자인 상담</a>
                                                </p>
                                                <ul class="buttons">
                                                    <li><a href="#cancel-modal" class="btn_1 gray delete cancelBtn" data-bs-toggle="modal" th:data-cancel-reservation-id="*{reservationId}"><i class="fa fa-fw fa-times-circle-o"></i> 예약취소</a></li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- /tab -->

                        <div id="pane-D" class="card tab-pane fade" role="tabpanel" aria-labelledby="tab-D">
                            <div class="card-header" role="tab" id="heading-D">
                                <h5>
                                    <a class="collapsed" data-bs-toggle="collapse" href="#collapse-D" aria-expanded="true" aria-controls="collapse-D">
                                        방문완료
                                    </a>
                                </h5>
                            </div>
                            <div id="collapse-D" class="collapse" role="tabpanel" aria-labelledby="heading-D">
                                <div class="box_general">
                                    <div class="header_box">
                                        <h4 class="d-inline-block">예약 목록</h4>
                                    </div>
                                    <div class="list_general" th:each="reservation : ${reservations}" th:object="${reservation}" th:if="${reservation.reservationStatus.toString().equals('VISIT_COMPLETED')}">

                                        <ul>
                                            <li>
                                                <figure><img th:src="*{thumbnail}" alt=""></figure>
                                                <h4>[[*{storeName}]] <i th:class="*{reservationStatus.toString().toLowerCase()}">[[*{reservationStatus.getDescription()}]]</i></h4>
                                                <ul class="booking_list">
                                                    <li><strong>예약일</strong>[[*{reservedAt.toLocalDate()}]]</li>
                                                    <li><strong>예약시간</strong>[[*{reservedAt.toLocalTime()}]]</li>
                                                </ul>
                                                <p><a href="#" class="chat-button btn_1 gray"
                                                      th:data-reservation-id="*{reservationId}"
                                                      th:data-store-name="*{storeName}"
                                                      th:data-customer-name="*{customerName}"
                                                      th:data-customer-id="*{customerId}"
                                                      th:data-store-id="*{storeId}"
                                                      th:data-store-thumbnail="*{thumbnail}"
                                                      th:data-store-phone="*{storePhoneNumber}"
                                                      th:data-chat-url="${chatAccessUrl}">
                                                    <i class="fa fa-fw fa-envelope"></i> 디자인 상담</a>
                                                </p>
                                                <ul class="buttons">
                                                </ul>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- /tab -->
                        <div id="pane-E" class="card tab-pane fade" role="tabpanel" aria-labelledby="tab-E">
                            <div class="card-header" role="tab" id="heading-E">
                                <h5>
                                    <a class="collapsed" data-bs-toggle="collapse" href="#collapse-E" aria-expanded="true" aria-controls="collapse-E">
                                        취소됨
                                    </a>
                                </h5>
                            </div>
                            <div id="collapse-E" class="collapse" role="tabpanel" aria-labelledby="heading-E">
                                <div class="box_general">
                                    <div class="header_box">
                                        <h4 class="d-inline-block">예약 목록</h4>
                                    </div>
                                    <div class="list_general" th:each="reservation : ${reservations}" th:object="${reservation}" th:if="${reservation.reservationStatus.toString().equals('CANCELED')}">

                                        <ul>
                                            <li>
                                                <figure><img th:src="*{thumbnail}" alt=""></figure>
                                                <h4>[[*{storeName}]] <i th:class="*{reservationStatus.toString().toLowerCase()}">[[*{reservationStatus.getDescription()}]]</i></h4>
                                                <ul class="booking_list">
                                                    <li><strong>예약일</strong>[[*{reservedAt.toLocalDate()}]]</li>
                                                    <li><strong>예약시간</strong>[[*{reservedAt.toLocalTime()}]]</li>
                                                </ul>
                                                <p><a href="#" class="chat-button btn_1 gray"
                                                      th:data-reservation-id="*{reservationId}"
                                                      th:data-store-name="*{storeName}"
                                                      th:data-customer-name="*{customerName}"
                                                      th:data-customer-id="*{customerId}"
                                                      th:data-store-id="*{storeId}"
                                                      th:data-store-thumbnail="*{thumbnail}"
                                                      th:data-store-phone="*{storePhoneNumber}"
                                                      th:data-chat-url="${chatAccessUrl}">
                                                    <i class="fa fa-fw fa-envelope"></i> 디자인 상담</a>
                                                </p>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- /tab -->
                    </div>
                    <!-- /tab-content -->
                </div>
                <!-- /tabs_detail -->
            </div>
            <!-- /col -->

            <div class="col-lg-6" id="sidebar_fixed">
<!--                <div class="box_booking">-->
<!--                    <div class="main">-->
                        <div class="right-section">
                            <div id="user_chat_data" class="user_chat_data">
                                <div class="profile_name">
                                    <img id="store-thumbnail" class="mr-3 rounded-circle" style="width: 40px">
                                    <span id="store-name"></span>
                                    <i class="fa fa-phone ms-4 me-1"></i><span id="store-phone"></span>
<!--                                    <button id="ai-generate-button" class="btn btn-success ms-3">AI로 케이크시안을 만들어 보세요</button>-->
<!--                                    <div id="progress-bar-container" style="width: 100%; height: 5px; background-color: #f0f0f0; margin-top: 10px; display: none;">-->
<!--                                        <div id="progress-bar" style="width: 0%; height: 100%; background-color: #4CAF50;"></div>-->
<!--                                    </div>-->
                                </div>
                                <div class="container-fluid chat_section" id="chat-box"></div>
                                <div class="type_msg">
                                    <div class="input_msg_write">
                                        <button id="chat-attach" class="msg_attach_btn" type="button" style="border: 2px solid #4CAF50;">
                                            <i class="fa fa-paperclip" aria-hidden="true"></i>
                                        </button>
                                        <button id="chat-ai" class="msg_attach_btn" type="button" style="border: 2px solid #4CAF50;">
                                            <i class="fa fa-birthday-cake" aria-hidden="true"></i>
                                        </button>
                                        <input id="chat-outgoing-msg" type="text" class="write_msg" placeholder="Type a message"/>
                                        <button id="chat-send" class="msg_send_btn" type="button">
                                            <i class="fa fa-paper-plane" aria-hidden="true"></i>
                                        </button>
                                        <input id="chat-file-input" type="file" style="display: none;"/>
                                    </div>
                                    <div style="margin-top: 10px;">
                                        <button id="ai-generate-button" class="btn btn-success" style="width: 100%;">AI로 케이크시안을 만들어 보세요</button>
                                        <div id="progress-bar-container" style="width: 100%; height: 5px; background-color: #f0f0f0; margin-top: 10px; display: none;">
                                            <div id="progress-bar" style="width: 0%; height: 100%; background-color: #4CAF50;"></div>
                                        </div>
                                    </div>
                                </div>
                                    <div id="file-preview" class="file-preview"></div>
                                </div>
                            </div>
<!--                        </div>-->
<!--                    </div>-->
                </div>
            </div>

        </div>
        <!-- /row -->
    </div>
    <!-- /container -->

    <!-- AI 이미지 선택 모달 -->
    <div id="aiImageModal" class="modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">AI 이미지 선택</h5>
<!--                    <button type="button" class="close" id="closeBtn" data-dismiss="modal" aria-label="Close">-->
<!--                        <span aria-hidden="true">&times;</span>-->
<!--                    </button>-->
                </div>
                <div class="modal-body">
                    <!-- 이미지 선택 그리드 -->
                    <div class="image-selection-grid" style="max-height: 500px; overflow-y: auto;">
                        <!-- 여기에 max-height로 스크롤 -->
                        <div th:each="image : ${imageList}"
                             style="display: flex; align-items: center; margin-bottom: 10px;">
                            <input type="radio" name="selectedImage" th:value="${image.generatedUrl}"
                                   class="select-image-radio" style="margin-right: 10px;">
                            <img th:src="@{${image.generatedUrl}}" th:alt="${image.inputText}" class="selectable-image"
                                 style="width: 100px; height: 100px; cursor: pointer;">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="closeBtn2" data-dismiss="modal">닫기</button>
                    <button type="button" class="btn btn-primary" id="selectImageButton">선택하기</button>
                </div>
            </div>

        </div>
    </div>
    <!--  여기까지 ai 모달-->

    <!--  예약 취소 모달 -->
    <div id="cancel-modal" class="modal">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">예약 취소</h4>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="cancelForm" th:action="@{/customer/reservation/cancel}" method="POST">
                        <input name="reservationId" id="cancel-reservId" hidden="hidden">
                        <div class="mb-3">
                            <label for="cancelReason" class="form-label">취소 사유</label>
                            <textarea class="form-control" id="cancelReason" name="reason" placeholder="취소 사유를 입력하세요"></textarea>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
                            <button type="button" id="submitCancel" class="btn btn-primary">제출</button>
                        </div>
                    </form>
                </div>

            </div>
        </div>
    </div>
    <!-- 여기까지 취소 모달 -->

    <!-- 사용자 정의 모달 -->
    <div class="modal fade custom-modal" id="customPromptModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">케이크 시안을 만들어 드릴게요</h5>
                    <!--                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">-->
                    <!--                        <span aria-hidden="true">&times;</span>-->
                    <!--                    </button>-->
                </div>
                <div class="modal-body">
                    원하는 케이크에 대해 설명해주세요:
                    <input type="text" id="cakeDescriptionInput" placeholder="예: 올라프 케이크, 귀여운 디자인 등">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="cancelBtn2" data-dismiss="modal">취소</button>
                    <button type="button" class="btn btn-primary" id="confirmCakeDescription">확인</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Progress Bar -->
    <!-- Toast 메시지 -->
    <div id="toast" style="visibility: hidden; position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background-color: #4CAF50; color: #ffffff; padding: 16px; border-radius: 5px; z-index: 1000;">생성이 완료되었습니다! 채팅창 왼쪽에 케이크 모양을 클릭하세요!</div>
    </div>






</main>
</body>
<div layout:fragment="js">
    <script th:src="@{/vendor/admin/jquery-easing/jquery.easing.min.js}"></script>
    <script th:src="@{/vendor/admin/jquery.magnific-popup.min.js}"></script>
    <!-- 이 페이지 전용 스크립트 -->
    <script th:src="@{/js/customer/sticky_sidebar.min.js}"></script>

    <script th:inline="javascript">
        let selectedImageUrl = null; // selectedImageUrl 변수를 초기화합니다.

        // 모달이 열릴 때마다 이미지 선택 상태 초기화
        $('#aiImageModal').on('show.bs.modal', function () {
            // 선택된 이미지 상태 초기화
            document.querySelectorAll('.selectable-image').forEach(img => img.style.border = 'none');
            document.querySelectorAll('.select-image-radio').forEach(radio => radio.checked = false);
        });

        let eventSource = null;
        let loadedMessageIds = new Set();
        let lastMessageId = null;
        let isLoading = false; // 중복 요청 방지

        (function ($) {
            "use strict";

            // Sticky sidebar
            $('#sidebar_fixed').theiaStickySidebar({
                minWidth: 991,
                updateSidebarHeight: true,
                additionalMarginTop: 25
            });
        })(window.jQuery);
        function scrollToBottom() {
            const chatSection = document.querySelector('.chat_section');
            chatSection.scrollTop = chatSection.scrollHeight;
        }

        function clearChatBox() {
            const chatBox = document.querySelector('#chat-box');
            chatBox.innerHTML = ''; // 이전 채팅 내용을 모두 삭제
        }

        function removeEventListeners(selector, eventName) {
            const elements = document.querySelectorAll(selector);
            elements.forEach(el => {
                const clone = el.cloneNode(true);
                el.parentNode.replaceChild(clone, el);
            });
        }

        function getSendMsgBox(data) {
            const date = new Date(data.createdAt);
            const timeString = `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
            const imgTag = data.customerImage ? `<img src="${data.customerImage}" alt="image" class="chat-image" style="max-width: 100%; max-height: 200px; cursor: pointer;" />` : '';
            return `<div>
        <p style="text-align: right;">${data.sender}</p>
        <div class="sent_msg">
            ${imgTag}
            <p style="text-align: right;">${data.msg}</p>
            <span class="time_date">${timeString}</span>
        </div>
    </div>`;
        }

        function getReceiveMsgBox(data) {
            const date = new Date(data.createdAt);
            const timeString = `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
            const imgTag = data.customerImage ? `<img src="${data.customerImage}" alt="image" class="chat-image" style="max-width: 100%; max-height: 200px; cursor: pointer;" />` : '';
            return `<div>
        <p>${data.sender}</p>
        <div class="received_withd_msg">
            ${imgTag}
            <p>${data.msg}</p>
            <span class="time_date">${timeString}</span>
        </div>
        <div></div>
    </div>`;
        }

        function initMyMessage(data) {
            let chatBox = document.querySelector("#chat-box");
            let sendBox = document.createElement("div");
            sendBox.className = "outgoing_msg";
            sendBox.innerHTML = getSendMsgBox(data);
            chatBox.append(sendBox);
            scrollToBottom();
        }

        function initYourMessage(data) {
            let chatBox = document.querySelector("#chat-box");
            let receivedBox = document.createElement("div");
            receivedBox.className = "received_msg";
            receivedBox.innerHTML = getReceiveMsgBox(data);
            chatBox.append(receivedBox);
            scrollToBottom();
        }


        async function loadRecentMessages() {
            let reservationId = window.reservationId;
            let chatUrl = window.chatUrl;
            try {
                // 최근 20개 메시지를 로드
                const response = await fetch(`${chatUrl}/chat/roomNum/${reservationId}/messages?limit=20`);
                const messages = await response.json();

                if (messages.length > 0) {
                    lastMessageId = messages[messages.length - 1].id; // 가장 오래된 메시지의 ID 저장

                    // 메시지들을 채팅창에 표시하고 ID를 저장
                    messages.reverse().forEach(message => {
                        const messageId = message.id || message.createdAt;
                        loadedMessageIds.add(messageId); // 메시지 ID 저장

                        if (message.itemName && message.quantity && message.totalAmount) {
                            addPaymentInfoToChat(message);
                        }
                        if (message.sender === window.customerName) {
                            initMyMessage(message);
                        } else {
                            initYourMessage(message);
                        }
                    });

                    scrollToBottom(); // 초기 로드 시 스크롤을 맨 아래로 이동
                }
            } catch (error) {
                console.error('Error loading recent messages:', error);
            }
        }

        async function loadMoreMessages() {
            console.log('loadMoreMessages function called');
            let reservationId = window.reservationId;
            let chatUrl = window.chatUrl;
            if (isLoading) {
                console.log('Loading in progress');
                return;
            }

            isLoading = true;

            try {
                console.log("Requesting more messages from server...");

                // 마지막으로 로드한 메시지 ID를 기준으로 이전 메시지를 요청
                let url = `${chatUrl}/chat/roomNum/${reservationId}/messages?limit=20`;
                if (lastMessageId) {
                    url += `&beforeId=${lastMessageId}`;
                }

                const response = await fetch(url);
                const messages = await response.json();

                console.log("Messages received:", messages.length); // 서버로부터 받은 메시지 개수 로그

                if (messages.length > 0) {
                    lastMessageId = messages[messages.length - 1].id;
                    const chatBox = document.querySelector("#chat-box");
                    const initialScrollHeight = chatBox.scrollHeight;

                    // 이미 로드된 메시지를 제외하고 새로운 메시지만 처리
                    messages.forEach(message => {
                        const messageId = message.id || message.createdAt;
                        if (!loadedMessageIds.has(messageId)) {
                            loadedMessageIds.add(messageId);
                            const messageElement = document.createElement("div");
                            if (message.itemName && message.quantity && message.totalAmount) {
                                addPaymentInfoToChat(message);
                            }
                            if (message.sender === window.customerName) {
                                messageElement.className = "outgoing_msg";
                                messageElement.innerHTML = getSendMsgBox(message);
                            } else {
                                messageElement.className = "received_msg";
                                messageElement.innerHTML = getReceiveMsgBox(message);
                            }

                            // 메시지를 채팅창 맨 위에 삽입
                            chatBox.insertBefore(messageElement, chatBox.firstChild);
                        }
                    });

                    // 마지막 메시지 ID 업데이트
                    // lastMessageId = messages[messages.length - 1].id;
                    console.log('Updated lastMessageId:', lastMessageId);

                    // 스크롤 위치 유지
                    chatBox.scrollTop = chatBox.scrollHeight - initialScrollHeight;
                } else {
                    console.log('No more messages to load.');
                }
            } catch (error) {
                console.error('Error loading more messages:', error);
            } finally {
                isLoading = false;
            }
        }

        function addPaymentInfoToChat(data) {
            console.log('Adding payment info:', data); // 데이터 확인

            const chatBox = document.querySelector("#chat-box");
            const date = new Date(data.createdAt);
            const timeString = `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
            const paymentInfoBox = document.createElement("div");
            paymentInfoBox.className = "payment-box";

            // Create the inner HTML for payment info
            paymentInfoBox.innerHTML = `
    <div class="payment-customer">
        <p><strong>상품명:</strong> ${data.itemName}</p>
        <p><strong>수량:</strong> ${data.quantity}</p>
        <p><strong>결제 금액:</strong> ${data.totalAmount}원</p>
        <button class="btn btn-primary btn-sm payment-btn">결제하기</button>
        <div></div>
        <span class="time_date">${timeString}</span>
    </div>`;

            chatBox.append(paymentInfoBox);

            const paymentButton = paymentInfoBox.querySelector(".payment-btn");
            paymentButton.setAttribute("data-reservation-id", window.reservationId);
            paymentButton.setAttribute("data-customer-id", window.customerId);
            paymentButton.setAttribute("data-store-id", window.storeId);

            paymentButton.onclick = function() {
                handlePayment(this);
            };

            scrollToBottom();
        }
        async function handlePayment(button) {
            const reservationId = button.getAttribute('data-reservation-id');
            const customerId = button.getAttribute('data-customer-id');
            const storeId = button.getAttribute('data-store-id');

            // Undefined 체크
            if (!reservationId || !customerId || !storeId) {
                console.error("Invalid data attributes: ", { reservationId, customerId, storeId });
                return; // 필요한 값이 없는 경우 진행 중단
            }

            const paragraphs = button.parentNode.querySelectorAll('p');
            let itemName = '';
            let quantity = '';
            let totalAmount = '';

            paragraphs.forEach(p => {
                if (p.textContent.includes('상품명:')) {
                    itemName = p.textContent.replace('상품명:', '').trim();
                } else if (p.textContent.includes('수량:')) {
                    quantity = p.textContent.replace('수량:', '').trim();
                } else if (p.textContent.includes('결제 금액:')) {
                    totalAmount = p.textContent.replace('결제 금액:', '').trim().replace(/[^0-9]/g, '');
                }
            });

            const taxFreeAmount = 0;

            const queryString = `partnerOrderId=${encodeURIComponent(reservationId)}&partnerUserId=${encodeURIComponent(customerId)}&shopId=${encodeURIComponent(storeId)}&itemName=${encodeURIComponent(itemName)}&quantity=${encodeURIComponent(quantity)}&totalAmount=${encodeURIComponent(totalAmount)}&taxFreeAmount=${encodeURIComponent(taxFreeAmount)}`;

            window.location.href = `/payment/request?${queryString}`;
        }


        document.querySelectorAll('.chat-button').forEach(button => {
            button.addEventListener('click', async function () {

                // 기존 SSE 연결 종료
                if (eventSource !== null) {
                    console.log("Closing previous SSE connection");
                    eventSource.close();
                    eventSource = null; // 기존 연결 해제
                }

                clearChatBox(); // 이전 채팅 내용 삭제

                // 여기서 loadedMessageIds와 lastMessageId를 초기화
                loadedMessageIds.clear();
                lastMessageId = null;

                // 오른쪽 섹션을 표시
                document.querySelector('.right-section').style.display = 'block';

                const reservationId = this.getAttribute('data-reservation-id');
                const storeName = this.getAttribute('data-store-name');
                const storeThumbnail = this.getAttribute('data-store-thumbnail');
                const storePhone = this.getAttribute('data-store-phone')
                const customerName = this.getAttribute('data-customer-name'); // 문제 해결: customerName 변수 정의
                const customerId = this.getAttribute('data-customer-id');
                const storeId = this.getAttribute('data-store-id');
                const chatUrl = this.getAttribute('data-chat-url');

                // 전역 변수 업데이트( ai 업로드에서도 사용해야되서)
                window.customerName = customerName;
                window.reservationId = reservationId;
                window.chatUrl = chatUrl;
                window.customerId = customerId;
                window.storeId = storeId;

                console.log("Reservation ID:", reservationId);
                console.log("Store Name:", storeName);
                console.log("Customer Name:", customerName);
                console.log("Customer ID:", customerId);
                console.log("Store ID:", storeId);
                console.log("Chat URL:", chatUrl);

                document.querySelector("#store-phone").textContent = storePhone;
                document.querySelector("#store-name").textContent = storeName;
                document.querySelector("#store-thumbnail").src = storeThumbnail;

                // 최근 메시지 20개 불러오기
                await loadRecentMessages(reservationId, chatUrl);

                // SSE 연결하기
                eventSource = new EventSource(`${chatUrl}/chat/roomNum/${reservationId}`);
                eventSource.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    const messageId = data.id || data.createdAt; // 유니크한 메시지 식별자

                    // 중복 메시지 체크 - loadedMessageIds에 없으면 추가
                    if (!loadedMessageIds.has(messageId)) {
                        loadedMessageIds.add(messageId); // 메시지 ID 추가

                        console.log("Received data:", data);

                        // 결제 정보가 포함된 메시지인 경우 처리
                        if (data.itemName && data.quantity && data.totalAmount) {
                            addPaymentInfoToChat(data);
                        }

                        // 메시지 발신자에 따른 메시지 처리
                        if (data.sender === customerName) {
                            initMyMessage(data);
                        } else {
                            initYourMessage(data);
                        }
                    } else {
                        console.log("Duplicate message ignored:", data);
                    }
                };

                eventSource.onerror = function () {
                    console.error("EventSource failed, closing connection.");
                    eventSource.close();
                    eventSource = null; // 오류 발생 시 연결 해제
                };

                // 스크롤 이벤트 리스너 추가 (스크롤이 상단에 도달하면 이전 메시지 로드)
                document.querySelector('.chat_section').addEventListener('scroll', function() {
                    if (this.scrollTop === 0 && !isLoading) {
                        console.log('Top of chat reached, loading more messages...');
                        loadMoreMessages(reservationId, chatUrl);
                    }
                });
                // 기존에 등록된 이벤트 리스너 제거
                removeEventListeners('#chat-send', 'click');
                removeEventListeners('#chat-outgoing-msg', 'keydown');
                removeEventListeners('#chat-attach', 'click');
                removeEventListeners('#chat-file-input', 'change');

                document.querySelector("#chat-send").addEventListener('click', () => addMessage(customerName, reservationId, chatUrl));
                document.querySelector("#chat-outgoing-msg").addEventListener('keydown', (e) => {
                    if (e.keyCode === 13) {
                        e.preventDefault();
                        addMessage(customerName, reservationId, chatUrl);
                    }
                });

                document.querySelector("#chat-attach").addEventListener("click", () => {
                    document.querySelector("#chat-file-input").click();
                });

                document.querySelector("#chat-file-input").addEventListener("change", () => {
                    const fileInput = document.querySelector("#chat-file-input");
                    const filePreview = document.querySelector("#file-preview");
                    filePreview.innerHTML = ''; // Clear previous preview

                    if (fileInput.files.length > 0) {
                        const file = fileInput.files[0];
                        const reader = new FileReader();

                        const previewContainer = document.createElement('div');
                        previewContainer.className = 'file-preview-item';

                        if (file.type.startsWith('image/')) {
                            reader.onload = function (e) {
                                const img = document.createElement('img');
                                img.src = e.target.result;
                                previewContainer.appendChild(img);
                            };
                            reader.readAsDataURL(file);
                        } else {
                            // Non-image file
                            const fileName = document.createElement('span');
                            fileName.textContent = file.name;
                            previewContainer.appendChild(fileName);
                        }
                        filePreview.appendChild(previewContainer);
                    }
                    scrollToBottom();
                });
            });

            async function addMessage(customerName, reservationId, chatUrl) {
                let msgInput = document.querySelector("#chat-outgoing-msg");
                let fileInput = document.querySelector("#chat-file-input");
                let filePreview = document.querySelector("#file-preview");
                let message = msgInput.value.trim();

                // 파일이 첨부되었거나 메시지가 비어있지 않을 경우에만 전송
                if (message === "" && !fileInput.files.length) {
                    return;
                }

                let formData = new FormData();

                // 메시지가 비어있지 않거나 파일이 첨부된 경우 메시지 추가
                if (message !== "" || fileInput.files.length > 0) {
                    formData.append("chat", new Blob([JSON.stringify({
                        sender: customerName,
                        roomNum: reservationId,
                        msg: message
                    })], {type: "application/json"}));
                }

                // 파일이 있는 경우 파일 추가
                if (fileInput.files.length > 0) {
                    formData.append("customerImage", fileInput.files[0]);
                }

                await fetch(`${chatUrl}/chat`, {
                    method: "post",
                    body: formData
                });

                // 입력 필드와 파일 필드 초기화
                msgInput.value = "";
                fileInput.value = "";
                filePreview.innerHTML = ""; // 파일 미리보기 영역 초기화
                scrollToBottom();
            }

            window.addEventListener('message', function (event) {
                if (event.origin !== "https://your-trusted-domain.com") {
                    return;
                }

                const data = event.data;

                if (data.status === 'success') {
                    alert('결제가 성공적으로 완료되었습니다!');
                    updatePaymentStatusUI(event.target);
                } else if (data.status === 'failure') {
                    alert('결제에 실패했습니다. 다시 시도해 주세요.');
                }
            });

            function updatePaymentStatusUI(button) {
                const paymentInfoBox = button.parentNode;
                paymentInfoBox.innerHTML += '<p><strong>결제 상태:</strong> 완료</p>';
                button.disabled = true;
            }
        });

        document.querySelector("#chat-ai").addEventListener("click", async () => {
            // 모달 열기 전에 데이터를 서버에서 동적으로 가져오기
            try {
                const response = await fetch('/customer/reservation/images'); // 서버에서 이미지를 가져오는 API 엔드포인트
                if (!response.ok) {
                    throw new Error('데이터를 불러오지 못했습니다.');
                }
                const imageList = await response.json();

                // 기존의 이미지를 초기화하고 새로 가져온 이미지 데이터로 갱신
                const imageSelectionGrid = document.querySelector('.image-selection-grid');
                imageSelectionGrid.innerHTML = ''; // 기존 이미지 초기화

                imageList.forEach(image => {
                    const imageContainer = document.createElement('div');
                    imageContainer.style.display = 'flex';
                    imageContainer.style.alignItems = 'center';
                    imageContainer.style.marginBottom = '10px';
                    imageContainer.innerHTML = `
                <input type="radio" name="selectedImage" value="${image.generatedUrl}" class="select-image-radio" style="margin-right: 10px;">
                <img src="${image.generatedUrl}" alt="${image.inputText}" class="selectable-image" style="width: 100px; height: 100px; cursor: pointer;">
            `;
                    imageSelectionGrid.appendChild(imageContainer);
                });

                // 라디오 버튼 클릭 시 선택된 이미지 URL 업데이트 (이벤트 위임 사용)
                document.querySelector('.image-selection-grid').addEventListener('change', function (e) {
                    if (e.target && e.target.classList.contains('select-image-radio')) {
                        selectedImageUrl = e.target.value;
                        document.querySelectorAll('.selectable-image').forEach(img => img.style.border = 'none');
                        e.target.nextElementSibling.style.border = '2px solid blue';
                    }
                });

                // 모달 표시
                $('#aiImageModal').modal('show');
            } catch (error) {
                console.error('모달 데이터를 가져오는 중 오류 발생:', error);
                alert('모달을 열 수 없습니다. 데이터를 불러오는 데 실패했습니다.');
            }
        });

        document.querySelector("#closeBtn2").addEventListener("click", () => {
            $('#aiImageModal').modal('hide');
        });

        // 라디오 버튼 클릭 시 선택된 이미지 URL 업데이트
        document.querySelectorAll('.select-image-radio').forEach(radio => {
            radio.addEventListener('change', function () {
                selectedImageUrl = this.value;
                document.querySelectorAll('.selectable-image').forEach(img => img.style.border = 'none');
                this.nextElementSibling.style.border = '2px solid blue';
            });
        });

        // "선택하기" 버튼 클릭 시 이미지 전송
        document.querySelector("#selectImageButton").addEventListener("click", () => {
            if (selectedImageUrl) {
                let formData = new FormData();
                formData.append("chat", new Blob([JSON.stringify({
                    sender: window.customerName,
                    roomNum: window.reservationId,
                    msg: "", // 메시지 내용 비워두기 (이미지만 전송)
                    customerImage: selectedImageUrl
                })], { type: "application/json" }));

                $.ajax({
                    url: `${window.chatUrl}/chat`,
                    type: 'POST',
                    data: formData,
                    contentType: false,
                    processData: false,
                    success: function (response) {
                        $('#aiImageModal').modal('hide');
                        selectedImageUrl = null;
                    },
                    error: function (error) {
                        console.error('Error sending image:', error);
                    }
                });
            } else {
                alert("이미지를 선택하세요.");
            }
        });

        // 파일 업로드 처리
        document.querySelector("#chat-attach").addEventListener("click", () => {
            document.querySelector("#chat-file-input").click();
        });

        document.querySelector("#chat-file-input").addEventListener("change", () => {
            const fileInput = document.querySelector("#chat-file-input");
            const filePreview = document.querySelector("#file-preview");
            filePreview.innerHTML = ''; // 이전 미리보기 초기화

            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                const reader = new FileReader();

                const previewContainer = document.createElement('div');
                previewContainer.className = 'file-preview-item';

                if (file.type.startsWith('image/')) {
                    reader.onload = function (e) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        previewContainer.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                } else {
                    const fileName = document.createElement('span');
                    fileName.textContent = file.name;
                    previewContainer.appendChild(fileName);
                }
                filePreview.appendChild(previewContainer);
            }
            scrollToBottom();
        });


        // 예약 취소 모달 이벤트 처리 시작
        document.querySelectorAll(".cancelBtn").forEach(button =>{
            button.addEventListener('click', function(){
                document.querySelector("#cancel-reservId").value = this.getAttribute('data-cancel-reservation-id');
            })
        });

        // 예약 취소 폼 제출
        document.getElementById("submitCancel").onclick = function() {
            const reason = document.getElementById("cancelReason").value;
            if (reason.trim() === "") {
                alert("취소 사유를 입력해주세요.");
            } else {
                document.getElementById("cancelForm").submit();
            }
        }

        // ai 생성 및 확인

        // document.addEventListener('DOMContentLoaded', function () {
        //     document.getElementById('ai-generate-button').addEventListener('click', async function () {
        //
        //         let cakeDescription = prompt('원하는 케이크에 대해 설명해주세요:');
        //
        //         // 취소 버튼을 누른 경우
        //         if (cakeDescription === null) {
        //             alert('취소하셨습니다.');
        //             return;
        //         }
        //
        //         // 입력이 빈 문자열인 경우 입력을 반복적으로 요청
        //         while (!cakeDescription.trim()) {
        //             alert('케이크 설명을 입력해주세요!');
        //             cakeDescription = prompt('원하는 케이크에 대해 설명해주세요:');
        //
        //             // 취소 버튼을 누른 경우
        //             if (cakeDescription === null) {
        //                 alert('취소하셨습니다.');
        //                 return;
        //             }
        //         }
        //
        //         if (cakeDescription) {
        //             // 버튼 텍스트 변경
        //             let buttonText = document.getElementById('ai-generate-button');
        //             let progressBarContainer = document.getElementById('progress-bar-container');
        //             let progressBar = document.getElementById('progress-bar');
        //
        //             buttonText.textContent = '진행 중...';
        //             progressBarContainer.style.display = 'block'; // 프로그레스 바 표시
        //             progressBar.style.width = '0%'; // 초기 너비 설정
        //
        //             let progress = 0;
        //
        //             // 80%까지 프로그레스 바 채우기
        //             let progressInterval = setInterval(() => {
        //                 if (progress < 80) {
        //                     progress += 1;
        //                     progressBar.style.width = `${progress}%`;
        //                 } else {
        //                     clearInterval(progressInterval); // 80%까지 채운 후에는 더 이상 증가하지 않음
        //                 }
        //             }, 200); // 200ms 간격으로 업데이트
        //
        //             try {
        //                 // 비동기 요청 처리
        //                 let response = await fetch('/ai/generate', {
        //                     method: 'POST',
        //                     headers: {
        //                         'Content-Type': 'application/x-www-form-urlencoded'
        //                     },
        //                     body: new URLSearchParams({
        //                         'cakeDescription': cakeDescription
        //                     })
        //                 });
        //
        //                 if (response.ok) {
        //                     let result = await response.json();
        //
        //                     // 서버에서 응답받은 데이터 처리 (예: 생성된 이미지 URL 사용)
        //                     console.log("생성된 이미지 URL:", result.generatedUrl);
        //
        //                     // 프로그레스 바 완료 처리
        //                     clearInterval(progressInterval); // 80% 채우기 중단
        //                     progressBar.style.width = '100%'; // 응답을 받은 후 100%로 설정
        //                     setTimeout(function () {
        //                         progressBarContainer.style.display = 'none'; // 완료 후 프로그레스 바 숨기기
        //                         buttonText.textContent = 'AI로 케이크시안을 만들어 보세요';
        //                         showToast(); // Toast 메시지 표시
        //                     }, 500);
        //                 } else {
        //                     // 오류 처리
        //                     let errorResponse = await response.json();
        //                     alert('오류: ' + (errorResponse.message || '요청 중 오류가 발생했습니다.'));
        //                     clearInterval(progressInterval);
        //                     progressBarContainer.style.display = 'none';
        //                     buttonText.textContent = 'AI로 케이크시안을 만들어 보세요';
        //                 }
        //             } catch (error) {
        //                 alert('요청 중 오류가 발생했습니다. 다시 시도해주세요.');
        //                 clearInterval(progressInterval);
        //                 progressBarContainer.style.display = 'none';
        //                 buttonText.textContent = 'AI로 케이크시안을 만들어 보세요';
        //             }
        //         }
        //     });
        //
        //     function showToast() {
        //         let toast = document.getElementById('toast');
        //         toast.classList.add('show'); // 클래스 추가 방식 변경
        //         setTimeout(function() {
        //             toast.classList.remove('show'); // 클래스 제거
        //         }, 3000);
        //     }
        // });

        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('ai-generate-button').addEventListener('click', async function () {

                // 사용자 정의 모달 열기
                $('#customPromptModal').modal('show');

                document.querySelector("#cancelBtn2").addEventListener("click", () => {
                    $('#customPromptModal').modal('hide');
                });


                $('#customPromptModal').on('show.bs.modal', function () {
                    // 입력 필드 초기화
                    document.getElementById('cakeDescriptionInput').value = '';
                });


                document.getElementById('confirmCakeDescription').addEventListener('click', function () {
                    let cakeDescription = document.getElementById('cakeDescriptionInput').value.trim();

                    if (cakeDescription === "") {
                        alert('케이크 설명을 입력해주세요!');
                    } else {
                        $('#customPromptModal').modal('hide');
                        // 이후 요청 처리 로직
                        startCakeGeneration(cakeDescription);
                    }
                });
            });

            function startCakeGeneration(cakeDescription) {
                let buttonText = document.getElementById('ai-generate-button');
                let progressBarContainer = document.getElementById('progress-bar-container');
                let progressBar = document.getElementById('progress-bar');

                buttonText.textContent = '진행 중...';
                progressBarContainer.style.display = 'block';
                progressBar.style.width = '0%';

                let progress = 0;

                let progressInterval = setInterval(() => {
                    if (progress < 80) {
                        progress += 1;
                        progressBar.style.width = `${progress}%`;
                    } else {
                        clearInterval(progressInterval);
                    }
                }, 200);

                // 비동기 요청 처리
                fetch('/ai/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: new URLSearchParams({
                        'cakeDescription': cakeDescription
                    })
                }).then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error('요청 실패');
                    }
                }).then(result => {
                    progressBar.style.width = '100%';
                    setTimeout(() => {
                        progressBarContainer.style.display = 'none';
                        buttonText.textContent = 'AI로 케이크시안을 만들어 보세요';
                        showToast();
                    }, 500);
                }).catch(error => {
                    alert('오류 발생: ' + error.message);
                    clearInterval(progressInterval);
                    progressBarContainer.style.display = 'none';
                    buttonText.textContent = 'AI로 케이크시안을 만들어 보세요';
                });
            }

            function showToast() {
                let toast = document.getElementById('toast');
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }
        });
    </script>
</div>
</html>
