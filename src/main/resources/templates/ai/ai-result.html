<!DOCTYPE html>
<!--ì›ë³¸ blog.html-->
<html lang="en" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{customer/layout/default}">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Foogra - Discover & Book the best restaurants at the best price">
    <meta name="author" content="Ansonika">
    <title>Foogra - Discover & Book the best restaurants at the best price</title>
    <!-- Favicons-->
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" type="image/x-icon" href="img/apple-touch-icon-57x57-precomposed.png">
    <link rel="apple-touch-icon" type="image/x-icon" sizes="72x72" href="img/apple-touch-icon-72x72-precomposed.png">
    <link rel="apple-touch-icon" type="image/x-icon" sizes="114x114"
          href="img/apple-touch-icon-114x114-precomposed.png">
    <link rel="apple-touch-icon" type="image/x-icon" sizes="144x144"
          href="img/apple-touch-icon-144x144-precomposed.png">
    <!-- GOOGLE WEB FONT -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
          rel="stylesheet">
    <!-- SPECIFIC CSS -->
    <link rel="stylesheet" th:href="@{/css/customer/blog.css}">
    <!-- YOUR CUSTOM CSS -->
    <link rel="stylesheet" th:href="@{/css/custom.css}">
</head>
<body>
<main class="bg_gray pattern" layout:fragment="main">
    <div class="row">
        <div class="col-xl-8 col-lg-7 col-md-7 d-none d-md-block">
            <div class="breadcrumbs blog">
                <ul>
                    <li>AI ì´ë¯¸ì§€ìƒì„±</a></li>
                    <li>ì‹œì•ˆìƒì„±í•˜ê¸°</a></li>
                    <!--				                <li>Page active</li>-->
                </ul>
            </div>
        </div>
        <!--					ì¼€ì´í¬ì‹œì•ˆ í”„ë¡¬í”„íŠ¸ ìƒì„±-->
        <!--                <div class="col-xl-4 col-lg-5 col-md-5">-->
        <!--                    <div class="search_bar_list">-->
        <!--                        <input type="text" class="form-control" placeholder="ì›í•˜ëŠ” ì¼€ì´í¬ì‹œì•ˆì„ ì ì–´ì£¼ì„¸ìš”">-->
        <!--                        <input type="submit" value="ìƒì„±">-->
        <!--&lt;!&ndash;                        <input type="text" class="form-control" placeholder="ì›í•˜ëŠ” ì¼€ì´í¬ì‹œì•ˆì„ ì ì–´ì£¼ì„¸ìš”" style="width: 100%; height: 50px; font-size: 18px;">&ndash;&gt;-->
        <!--&lt;!&ndash;                        <input type="submit" value="ìƒì„±" style="height: 50px; font-size: 18px;">&ndash;&gt;-->
        <!--                    </div>-->
        <!--                </div>-->
    </div>
    <!-- /row -->
    </div>
    <!-- /page_header -->
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="widget">
                    <div class="widget-title first text-center">
                        <h4 style="font-size: 1.5rem; font-weight: 600;">AIë¡œ ì¼€ì´í¬ ì‹œì•ˆìƒì„± í•˜ê¸°</h4>
                    </div>
                    <div class="form-container p-4 shadow-sm rounded" style="background-color: #f9f9f9; max-width: 600px; margin: 0 auto;">
                        <form id="generateForm" method="post">
                            <div class="form-group">
                                <label for="cakePrompt" style="font-size: 1.2rem; font-weight: 500;">ì¼€ì´í¬ ì‹œì•ˆ</label>
                                <input id="cakePrompt" type="text" name="cakeDescription" class="form-control"
                                       placeholder="ì›í•˜ëŠ” ì¼€ì´í¬ ì‹œì•ˆì„ ì ì–´ì£¼ì„¸ìš”"
                                       style="height: 120px; font-size: 1rem; padding: 10px; border-radius: 10px; border: 1px solid #ccc;">
                            </div>
                            <div class="text-center mt-4">
                                <input type="submit" value="ìƒì„±" class="btn btn-primary btn-lg px-5" style="border-radius: 30px;">
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ì´ë¯¸ì§€ 3ê°œì”© ì¶œë ¥ -->
    <div class="container margin_30_40">
        <div class="row" id="image-container">
            <th:block th:each="image : ${imageList}">
                <div class="col-md-4">
                    <article class="blog">
                        <figure style="width: 100%; height: 300px; overflow: hidden;">
                            <img th:src="${image.generatedUrl}" alt="Generated Image" style="width: 100%; height: 100%; object-fit: cover;">
                        </figure>
                        <div class="post_info">
                            <small th:text="${#temporals.format(image.createdAt, 'yyyy-MM-dd')}">ìƒì„± ë‚ ì§œ</small>
                            <h3 th:text="${image.inputText}"></h3>
                            <p>ì´ ì´ë¯¸ì§€ëŠ” AIë¡œ ìƒì„±ëœ ì¼€ì´í¬ ì‹œì•ˆì…ë‹ˆë‹¤.</p>
                        </div>
                    </article>
                </div>
            </th:block>
        </div>
    </div>
    <div id="loading-indicator"
         style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);">
        <div style="background-color: #fff; padding: 40px; border-radius: 20px; box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.1); text-align: center; max-width: 500px;">
            <div class="spinner-border text-success" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p style="margin: 0; font-size: 24px; font-weight: 500;">
                ì¼€ì´í¬ ì‹œì•ˆ ìƒì„±ì¤‘ì…ë‹ˆë‹¤ <br> ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”ğŸ° <br> -ë§ˆì‹¯ë‹¹-
            </p>
        </div>
    </div>
    <!-- í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼ -->
    <nav aria-label="Page navigation" class="text-center">
        <ul class="pagination justify-content-center" id="pagination">
            <!-- í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
        </ul>
    </nav>
</main>
<!-- /main -->
<div id="toTop"></div><!-- Back to top button -->
<div class="layer"></div><!-- Opacity Mask Menu Mobile -->
<!-- /Sign In Modal -->
<!--&lt;!&ndash; í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼ &ndash;&gt;-->
<!--<nav aria-label="Page navigation" class="text-center">-->
<!--    <ul class="pagination justify-content-center" id="pagination">-->
<!--        &lt;!&ndash; í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼ë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ &ndash;&gt;-->
<!--    </ul>-->
<!--</nav>-->
<!--<div class="pagination_fg" style="display: block; visibility: visible;">-->
<!--    <a href="javascript:void(0);" onclick="loadPage(1)">&laquo;</a> &lt;!&ndash; First page or previous page functionality &ndash;&gt;-->
<!--    <a href="javascript:void(0);" class="active" onclick="loadPage(1)">1</a>-->
<!--    <a href="javascript:void(0);" onclick="loadPage(2)">2</a>-->
<!--    <a href="javascript:void(0);" onclick="loadPage(3)">3</a>-->
<!--    <a href="javascript:void(0);" onclick="loadPage(4)">4</a>-->
<!--    <a href="javascript:void(0);" onclick="loadPage(5)">5</a>-->
<!--    <a href="javascript:void(0);" onclick="loadPage(5)">&raquo;</a> &lt;!&ndash; Last page or next page functionality &ndash;&gt;-->
<!--</div>-->
<!-- COMMON SCRIPTS -->
<div layout:fragment="js">
    <script>
        // í¼ ì „ì†¡ ì´ë²¤íŠ¸ë¥¼ ìº¡ì²˜
        $('#generateForm').submit(function (event) {
            event.preventDefault();
            // ì…ë ¥ê°’ ê²€ì¦
            let cakePrompt = $('#cakePrompt').val().trim();
            if (cakePrompt === '') {
                alert('ì›í•˜ëŠ” ì¼€ì´í¬ì‹œì•ˆì„ ì ì–´ì£¼ì„¸ìš”');
                return;  // ì…ë ¥ê°’ì´ ì—†ìœ¼ë©´ í¼ ì „ì†¡ ì¤‘ë‹¨
            }
            // í¼ ë°ì´í„° ìˆ˜ì§‘
            let formData = $(this).serialize();
            // ë²„íŠ¼ ë¹„í™œì„±í™”
            $(this).find('input[type="submit"]').attr('disabled', 'disabled');
            // ë¡œë”© ì¸ë””ì¼€ì´í„° í‘œì‹œ
            $('#loading-indicator').show();
            // '[@{/ai/generate}]'
            // AJAX ìš”ì²­
            $.ajax({
                url: '/ai/generate',  // ì„œë²„ì—ì„œ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ëŠ” ì—”ë“œí¬ì¸íŠ¸
                type: 'POST',
                data: formData,
                dataType: 'json',  // ì„œë²„ ì‘ë‹µì´ JSONì´ë¼ê³  ëª…ì‹œ
                success: function (data) {
                    $('#loading-indicator').hide(); // ë¡œë”© ìˆ¨ê¹€
                    console.log(data); // objectë¡œ ë°›ì•„ì˜´
                    if (data.url !== null && data.url !== '') {
                        // ì„±ê³µì ìœ¼ë¡œ ìƒì„±ëœ ì´ë¯¸ì§€ì™€ ê´€ë ¨ ì •ë³´ë¥¼ ì²˜ë¦¬
                        let newImageBlock = `
        <div class="col-md-6">
            <article class="blog">
                <figure>
                    <img src="${data.url}" alt="Generated Image">
                    <span class="ribbon off">new</span>
                </figure>
                <div class="post_info">
                    <small>${new Date(data.createdAt).toLocaleDateString()}</small>
                    <h3>${data.description}</h3>
                    <p>ì´ ì´ë¯¸ì§€ëŠ” AIë¡œ ìƒì„±ëœ ì¼€ì´í¬ ì‹œì•ˆì…ë‹ˆë‹¤.</p>
                </div>
            </article>
        </div>
    `;


                        // ìƒˆë¡œìš´ ë¸”ë¡ì„ ì¶”ê°€
                        // $('#image-container').append(newImageBlock);
                        $('#image-container').prepend(newImageBlock); // ìƒì„±ëœê²Œ ë§¨ ì•ìœ¼ë¡œ


                        // í¼ ì´ˆê¸°í™”
                        $('#generateForm')[0].reset();
                    } else {
                        alert("ì´ë¯¸ì§€ ìƒì„± ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                    }
                },
                error: function (xhr, status, error) {
                    $('#loading-indicator').hide();
                    // console.error('Error:', error);
                    // alert('ìš”ì²­ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    console.error('Error:', error);
                    if (xhr.responseJSON && xhr.responseJSON.message) {
                        // ì„œë²„ì—ì„œ ë³´ë‚¸ ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ í‘œì‹œ
                        alert(xhr.responseJSON.message);
                    } else {
                        alert('ìš”ì²­ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    }
                },
                complete: function () {
                    // ìš”ì²­ì´ ëë‚˜ë©´ ë²„íŠ¼ì„ ë‹¤ì‹œ í™œì„±í™”
                    $('#generateForm').find('input[type="submit"]').removeAttr('disabled');
                }
            });
        });
    </script>
    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì²« ë²ˆì§¸ í˜ì´ì§€ ìë™ ë¡œë“œ
        $(document).ready(function () {
            loadPage(1);  // ì²« ë²ˆì§¸ í˜ì´ì§€ ë¡œë“œ
        });
        function loadPage(page) {
            $.ajax({
                url: `/api/ai-result?page=${page}&size=6`,  // ìš”ì²­í•  URLê³¼ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    // ì„œë²„ ì‘ë‹µ í™•ì¸
                    console.log(data);
                    // ì´ë¯¸ì§€ ëª©ë¡ ì—…ë°ì´íŠ¸
                    $('#image-container').empty();
                    data.imageList.forEach(function (image) {
                        $('#image-container').append(`
                    <div class="col-md-4">
                        <article class="blog">
                            <figure style="width: 100%; height: 300px; overflow: hidden;">
                                <img src="${image.generatedUrl}" alt="Generated Image" style="width: 100%; height: 100%; object-fit: cover;">
                            </figure>
                            <div class="post_info">
                                <small>${new Date(image.createdAt).toLocaleDateString()}</small>
                                <h3>${image.inputText}</h3>
                                <p>ì´ ì´ë¯¸ì§€ëŠ” AIë¡œ ìƒì„±ëœ ì¼€ì´í¬ ì‹œì•ˆì…ë‹ˆë‹¤.</p>
                            </div>
                        </article>
                    </div>
                `);
                    });
                    // í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ ì—…ë°ì´íŠ¸
                    updatePagination(data.currentPage, data.totalPages);
                },
                error: function (error) {
                    console.error("Error loading page:", error);
                }
            });
        }
        function updatePagination(currentPage, totalPages) {
            const pagination = $('#pagination');
            pagination.empty();
            // ì´ì „ í˜ì´ì§€ë¡œ ì´ë™ ë²„íŠ¼ (ì²« í˜ì´ì§€ì—ì„œëŠ” ë¹„í™œì„±í™”)
            if (currentPage > 1) {
                pagination.append(`
            <li class="page-item">
                <a class="page-link" href="javascript:void(0);" onclick="loadPage(${currentPage - 1})">&laquo;</a>
            </li>
        `);
            }
            // í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼ ìƒì„±
            for (let i = 1; i <= totalPages; i++) {
                pagination.append(`
            <li class="page-item ${i === currentPage ? 'active' : ''}">
                <a class="page-link ${i === currentPage ? 'disabled' : ''}" href="javascript:void(0);" onclick="loadPage(${i})">${i}</a>
            </li>
        `);
            }
            // ë‹¤ìŒ í˜ì´ì§€ë¡œ ì´ë™ ë²„íŠ¼ (ë§ˆì§€ë§‰ í˜ì´ì§€ì—ì„œëŠ” ë¹„í™œì„±í™”)
            if (currentPage < totalPages) {
                pagination.append(`
            <li class="page-item">
                <a class="page-link" href="javascript:void(0);" onclick="loadPage(${currentPage + 1})">&raquo;</a>
            </li>
        `);
            }
        }
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì²« ë²ˆì§¸ í˜ì´ì§€ ìë™ ë¡œë“œ
        $(document).ready(function () {
            loadPage(1);  // ì²« ë²ˆì§¸ í˜ì´ì§€ ë¡œë“œ
        });
    </script>
</div>
</body>
</html>